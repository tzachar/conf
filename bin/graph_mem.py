import matplotlib.pyplot
import matplotlib.dates as mdates
import matplotlib 
import pylab
import sys
import pytz


# file is generated by pidstat -C pop -ruh 1

f_name = sys.argv[1]
print "opening ", f_name
f=open(f_name)

timestamp=[]
vs=[]
vs_index = -1
rs=[]
rs_index = -1
cpu=[]
cpu_index = -1

f.readline()
for line in f:
	if len(line) <= 1: 
		continue
	if (line[0] == "#" and vs_index == -1):
		s = line.split();
		vs_index = s.index('VSZ')-1
		rs_index = s.index('RSS')-1
		cpu_index = s.index('%CPU')-1
		continue
	if (line[0] == "#"):
		continue
	s = line.split()
	if len(s) == 0:
		continue
	timestamp.append(int(s[0]))
	vs.append(float(s[vs_index]))
	rs.append(float(s[rs_index]))
	cpu.append(float(s[cpu_index]))

vs = [x/2**20 for x in vs]
rs = [x/2**20 for x in rs]
dates = [mdates.num2date((3*3600+x)/86400.0) for x in timestamp]

fig = matplotlib.pyplot.figure(1)
ax1 = fig.add_subplot(111)

ax1.plot(dates, vs, label='virtual')
ax1.plot(dates, rs, label='rs')
#ax1.plot(dates, cpu, label='cpu')

avg=sum(cpu)/len(cpu)
print "avg cpu: ", avg

ax1.legend();
ax1.grid(True)
ax1.format_xdata = mdates.DateFormatter('%H:%M')
fig.autofmt_xdate()


#matplotlib.pyplot.plot_date(tt, vs, label='virtual', color='b', linestyle='-', marker='None')
#matplotlib.pyplot.plot_date(tt, rs, label='rs', color='g', linestyle='-', marker='None')

matplotlib.pyplot.show()

